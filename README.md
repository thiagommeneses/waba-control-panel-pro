# WABA Control Panel Pro

![WABA Control Panel Pro](https://images.unsplash.com/photo-1611224923853-80b023f02d71?w=1200&h=400&fit=crop&crop=center)

Um painel de controle profissional para gerenciar a API do WhatsApp Business, permitindo envio de templates, cria√ß√£o de templates personalizados, e gerenciamento completo de respostas de clientes.

## üöÄ Funcionalidades

### üì§ **Envio de Templates**
- Envio de templates aprovados do WhatsApp Business
- Suporte a par√¢metros din√¢micos
- Valida√ß√£o de n√∫meros de telefone
- Preview em tempo real das mensagens
- Hist√≥rico completo de mensagens enviadas

### üìù **Cria√ß√£o de Templates**
- Interface intuitiva para cria√ß√£o de novos templates
- Suporte a diferentes tipos de cabe√ßalho (texto, imagem, v√≠deo, documento)
- Configura√ß√£o de bot√µes interativos (resposta r√°pida, URL, telefone)
- Valida√ß√£o autom√°tica antes do envio
- Sistema de aprova√ß√£o integrado com Meta

### üí¨ **Gerenciamento de Respostas**
- Visualiza√ß√£o de todas as respostas dos clientes
- Suporte a diferentes tipos de mensagem (texto, imagem, bot√µes)
- Sistema de filtros avan√ßados
- Pagina√ß√£o eficiente
- Respostas via WhatsApp Web ou API

### üîß **Configura√ß√µes Avan√ßadas**
- Configura√ß√£o completa da API do WhatsApp Business
- Gerenciamento de webhooks
- Logs detalhados de API
- Sistema de monitoramento em tempo real

## üõ†Ô∏è Tecnologias Utilizadas

### Frontend
- **React 18** - Framework principal
- **TypeScript** - Tipagem est√°tica
- **Vite** - Build tool e dev server
- **Tailwind CSS** - Framework de estiliza√ß√£o
- **shadcn/ui** - Componentes de interface
- **React Hook Form** - Gerenciamento de formul√°rios
- **Zod** - Valida√ß√£o de schemas
- **TanStack Query** - Gerenciamento de estado server

### Backend
- **Supabase** - Backend as a Service
- **PostgreSQL** - Banco de dados
- **Edge Functions** - Serverless functions
- **Row Level Security** - Seguran√ßa de dados

### Bibliotecas Principais
- **@radix-ui** - Componentes primitivos acess√≠veis
- **lucide-react** - √çcones
- **date-fns** - Manipula√ß√£o de datas
- **class-variance-authority** - Variantes de componentes
- **sonner** - Notifica√ß√µes toast

## üìã Pr√©-requisitos

- **Node.js 18+**
- **npm ou yarn**
- **Conta no Supabase**
- **Conta no Meta for Developers**
- **WhatsApp Business API configurada**

## ‚öôÔ∏è Configura√ß√£o e Instala√ß√£o

### 1. Clone o reposit√≥rio
```bash
git clone <seu-repositorio>
cd waba-control-panel-pro
```

### 2. Instale as depend√™ncias
```bash
npm install
```

### 3. Configure o Supabase

#### 3.1. Crie um projeto no Supabase
1. Acesse [supabase.com](https://supabase.com)
2. Crie um novo projeto
3. Anote a URL e a chave an√¥nima

#### 3.2. Configure o banco de dados
Execute as migrations SQL para criar as tabelas necess√°rias:

```sql
-- Tabela de configura√ß√µes da API
CREATE TABLE api_settings (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    waba_id TEXT NOT NULL,
    business_id TEXT NOT NULL,
    phone_number_id TEXT NOT NULL,
    access_token TEXT NOT NULL,
    api_version TEXT DEFAULT 'v23.0',
    request_timeout INTEGER DEFAULT 30000,
    webhook_url TEXT,
    webhook_secret TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Tabela de mensagens enviadas
CREATE TABLE sent_messages (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    template_name TEXT NOT NULL,
    phone_number TEXT NOT NULL,
    status TEXT NOT NULL,
    parameters JSONB,
    wamid TEXT,
    error_message TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Tabela de respostas dos clientes
CREATE TABLE client_responses (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    phone_number TEXT NOT NULL,
    message_type TEXT NOT NULL,
    content TEXT,
    image_url TEXT,
    image_caption TEXT,
    button_payload TEXT,
    wamid TEXT,
    timestamp_received TIMESTAMPTZ NOT NULL,
    context_wamid TEXT,
    client_name TEXT,
    metadata JSONB,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Tabela de logs da API
CREATE TABLE api_logs (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    endpoint TEXT NOT NULL,
    request_method TEXT NOT NULL,
    request_body JSONB,
    response_status INTEGER,
    response_body JSONB,
    error_message TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 3.3. Configure as Edge Functions
Deploy as Edge Functions do Supabase:

```bash
# Instale a CLI do Supabase
npm install -g supabase

# Fa√ßa login
supabase login

# Conecte ao seu projeto
supabase link --project-ref SEU_PROJECT_REF

# Deploy das functions
supabase functions deploy whatsapp-webhook
```

### 4. Configure as vari√°veis de ambiente

Atualize o arquivo `src/integrations/supabase/client.ts` com suas credenciais:

```typescript
const SUPABASE_URL = "SUA_SUPABASE_URL";
const SUPABASE_PUBLISHABLE_KEY = "SUA_SUPABASE_ANON_KEY";
```

### 5. Configure o Meta for Developers

#### 5.1. Crie uma aplica√ß√£o
1. Acesse [developers.facebook.com](https://developers.facebook.com)
2. Crie uma nova aplica√ß√£o
3. Adicione o produto "WhatsApp Business"

#### 5.2. Configure o webhook
- **URL do Webhook**: `https://SUA_SUPABASE_URL/functions/v1/whatsapp-webhook`
- **Token de verifica√ß√£o**: `webhook_verify_token`
- **Campos de assinatura**: messages

### 6. Inicie o servidor de desenvolvimento
```bash
npm run dev
```

## üìÅ Estrutura do Projeto

```
src/
‚îú‚îÄ‚îÄ components/              # Componentes React
‚îÇ   ‚îú‚îÄ‚îÄ ui/                 # Componentes de interface (shadcn/ui)
‚îÇ   ‚îú‚îÄ‚îÄ templates/          # Componentes espec√≠ficos de templates
‚îÇ   ‚îú‚îÄ‚îÄ ApiLogs.tsx         # Logs da API
‚îÇ   ‚îú‚îÄ‚îÄ AppSidebar.tsx      # Barra lateral principal
‚îÇ   ‚îú‚îÄ‚îÄ ClientResponses.tsx # Gerenciamento de respostas
‚îÇ   ‚îú‚îÄ‚îÄ CreateTemplate.tsx  # Cria√ß√£o de templates
‚îÇ   ‚îú‚îÄ‚îÄ MessagePreview.tsx  # Preview de mensagens
‚îÇ   ‚îú‚îÄ‚îÄ ReplyModal.tsx      # Modal de resposta
‚îÇ   ‚îú‚îÄ‚îÄ SendTemplate.tsx    # Envio de templates
‚îÇ   ‚îú‚îÄ‚îÄ SentTemplates.tsx   # Hist√≥rico de envios
‚îÇ   ‚îî‚îÄ‚îÄ Settings.tsx        # Configura√ß√µes
‚îú‚îÄ‚îÄ hooks/                  # Hooks customizados
‚îÇ   ‚îú‚îÄ‚îÄ templates/          # Hooks espec√≠ficos de templates
‚îÇ   ‚îî‚îÄ‚îÄ useTemplateSubmission.ts
‚îú‚îÄ‚îÄ integrations/           # Integra√ß√µes externas
‚îÇ   ‚îî‚îÄ‚îÄ supabase/          # Cliente Supabase
‚îú‚îÄ‚îÄ lib/                   # Utilit√°rios
‚îú‚îÄ‚îÄ pages/                 # P√°ginas da aplica√ß√£o
‚îú‚îÄ‚îÄ types/                 # Defini√ß√µes de tipos TypeScript
‚îî‚îÄ‚îÄ utils/                 # Fun√ß√µes utilit√°rias

supabase/
‚îú‚îÄ‚îÄ functions/             # Edge Functions
‚îÇ   ‚îú‚îÄ‚îÄ whatsapp-webhook/  # Webhook do WhatsApp
‚îÇ   ‚îî‚îÄ‚îÄ download-whatsapp-image/ # Download de imagens
‚îî‚îÄ‚îÄ config.toml           # Configura√ß√£o do Supabase
```

## üîß Como Usar

### 1. Configura√ß√£o Inicial

Ap√≥s a instala√ß√£o, acesse a aba "Configura√ß√µes" e preencha:
- **WABA ID**: ID da sua conta WhatsApp Business
- **Business ID**: ID do seu neg√≥cio
- **Phone Number ID**: ID do n√∫mero de telefone
- **Access Token**: Token de acesso da API
- **Webhook URL**: URL do webhook (automaticamente configurada)

### 2. Enviando Templates

1. Acesse a aba "Enviar Template"
2. Selecione um template aprovado
3. Preencha os par√¢metros necess√°rios
4. Digite o n√∫mero do destinat√°rio
5. Visualize o preview e envie

### 3. Criando Novos Templates

1. Acesse a aba "Criar Template"
2. Preencha as informa√ß√µes b√°sicas (nome, categoria, idioma)
3. Configure o conte√∫do (cabe√ßalho, corpo, rodap√©)
4. Adicione bot√µes se necess√°rio
5. Envie para aprova√ß√£o

### 4. Gerenciando Respostas

1. Acesse a aba "Respostas dos Clientes"
2. Visualize todas as mensagens recebidas
3. Use filtros para encontrar mensagens espec√≠ficas
4. Responda via WhatsApp Web ou API

## üîó API e Webhook

### Endpoints Dispon√≠veis

#### Webhook do WhatsApp
- **URL**: `/functions/v1/whatsapp-webhook`
- **M√©todo**: `GET` (verifica√ß√£o), `POST` (recebimento)
- **Autentica√ß√£o**: Assinatura HMAC SHA-256

#### Download de Imagens
- **URL**: `/functions/v1/download-whatsapp-image`
- **M√©todo**: `POST`
- **Par√¢metros**: `imageId`, `accessToken`

### Estrutura do Webhook

O webhook recebe notifica√ß√µes do WhatsApp no seguinte formato:

```json
{
  "object": "whatsapp_business_account",
  "entry": [
    {
      "id": "WABA_ID",
      "changes": [
        {
          "value": {
            "messaging_product": "whatsapp",
            "metadata": {
              "display_phone_number": "PHONE_NUMBER",
              "phone_number_id": "PHONE_NUMBER_ID"
            },
            "contacts": [
              {
                "profile": {
                  "name": "CUSTOMER_NAME"
                },
                "wa_id": "CUSTOMER_PHONE"
              }
            ],
            "messages": [
              {
                "from": "CUSTOMER_PHONE",
                "id": "MESSAGE_ID",
                "timestamp": "TIMESTAMP",
                "type": "text",
                "text": {
                  "body": "MESSAGE_CONTENT"
                }
              }
            ]
          },
          "field": "messages"
        }
      ]
    }
  ]
}
```

## üöÄ Deploy

### Deploy no Vercel

1. Conecte seu reposit√≥rio ao Vercel
2. Configure as vari√°veis de ambiente
3. Deploy autom√°tico a cada push

### Deploy no Netlify

1. Conecte seu reposit√≥rio ao Netlify
2. Configure o comando de build: `npm run build`
3. Configure o diret√≥rio de publica√ß√£o: `dist`

### Vari√°veis de Ambiente para Produ√ß√£o

```bash
# Supabase
VITE_SUPABASE_URL=sua_supabase_url
VITE_SUPABASE_ANON_KEY=sua_supabase_anon_key

# WhatsApp Business API
VITE_WHATSAPP_API_VERSION=v23.0
```

## ü§ù Contribuindo

1. Fa√ßa um fork do projeto
2. Crie uma branch para sua feature (`git checkout -b feature/nova-feature`)
3. Commit suas mudan√ßas (`git commit -am 'Adiciona nova feature'`)
4. Push para a branch (`git push origin feature/nova-feature`)
5. Abra um Pull Request

### Padr√µes de C√≥digo

- Use TypeScript para tipagem est√°tica
- Siga as conven√ß√µes do ESLint configurado
- Componentes devem ser funcionais com hooks
- Use Tailwind CSS para estiliza√ß√£o
- Mantenha os componentes pequenos e focados

## üìä Monitoramento e Logs

O sistema inclui monitoramento completo:

- **Logs de API**: Todas as requisi√ß√µes s√£o registradas
- **Status de Templates**: Acompanhamento do status de aprova√ß√£o
- **Webhooks**: Logs detalhados de recebimento
- **Erros**: Captura e exibi√ß√£o de erros em tempo real

## üîí Seguran√ßa

- Valida√ß√£o de assinatura HMAC para webhooks
- Sanitiza√ß√£o de dados de entrada
- Prote√ß√£o contra inje√ß√£o SQL via Supabase RLS
- Tokens de acesso armazenados de forma segura

## üì± Responsividade

O painel √© totalmente responsivo e funciona em:
- Desktop (1024px+)
- Tablet (768px - 1023px)
- Mobile (320px - 767px)

## üÜò Suporte e Documenta√ß√£o

### Problemas Comuns

**Template n√£o aprovado**: Verifique se o conte√∫do segue as diretrizes do WhatsApp Business.

**Webhook n√£o funciona**: Verifique se a URL est√° configurada corretamente no Meta for Developers.

**Erro de autentica√ß√£o**: Verifique se o access token est√° v√°lido e tem as permiss√µes necess√°rias.

### Links √öteis

- [Documenta√ß√£o oficial do WhatsApp Business API](https://developers.facebook.com/docs/whatsapp)
- [Documenta√ß√£o do Supabase](https://supabase.com/docs)
- [Guia de aprova√ß√£o de templates](https://developers.facebook.com/docs/whatsapp/business-management-api/message-templates)

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Veja o arquivo [LICENSE](LICENSE) para mais detalhes.

## üìû Contato

Para suporte ou d√∫vidas:
- üìß Email: thiagomm@icloud.com
- üí¨ WhatsApp: +55 (62) 9****-**22
- üåê Website pt_br: [pixmeyou.com](https://pixmeyou.com)
- üåê Website en_us: [us.pixmeyou.com](https://us.pixmeyou.com)

---

Desenvolvido com ‚ù§Ô∏è para facilitar o gerenciamento do WhatsApp Business API